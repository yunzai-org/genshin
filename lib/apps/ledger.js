import{plugin as e}from"yunzai";import t from"../model/ledger.js";import r from"node:fs";class s extends e{constructor(){super({priority:300,rule:[{reg:"^(#原石|#*札记|#*(星铁)?星琼)([0-9]|[一二两三四五六七八九十]+)*月*$",fnc:"ledger"},{reg:"^#(原石|(星铁)?星琼)任务$",permission:"master",fnc:"ledgerTask"},{reg:"^#*(原石|札记|(星铁)?星琼)统计$",fnc:"ledgerCount"},{reg:"^#*(去年|今年|\\d{4}年)(原石|札记|(星铁)?星琼)统计$",fnc:"ledgerCountHistory"}]}),Object.defineProperty(this,"button",{get(){return this.prefix=this.e?.isSr?"*星琼":"#原石",segment.button([{text:"记录",callback:this.prefix},{text:"统计",callback:`${this.prefix}统计`}])}})}async init(){let e=["./data/NoteData","./data/SR_NoteData"];for(let t of e)r.existsSync(t)||r.mkdirSync(t)}async ledger(){let e=await new t(this.e).get();e&&this.reply([await this.renderImg("genshin",`html/ledger/ledger-${e.game}`,e,{retType:"base64"}),this.button])}async ledgerTask(){let e=new t(this.e);await e.ledgerTask(!!this?.e?.msg)}async ledgerCount(){let e=await new t(this.e).ledgerCount();e&&this.reply([await this.renderImg("genshin",`html/ledger/ledger-count-${e.game}`,e,{retType:"base64"}),this.button])}async ledgerCountHistory(){let e=await new t(this.e).ledgerCountHistory();e&&this.reply([await this.renderImg("genshin",`html/ledger/ledger-count-${e.game}`,e,{retType:"base64"}),this.button])}}export{s as ledger};
