import{plugin as e}from"yunzai";import t from"node:fs";import{gsCfg as s}from"yunzai-mys";import i from"../model/roleIndex.js";import r from"../model/abyss.js";import a from"../model/weapon.js";class n extends e{constructor(){super({priority:200,rule:[{reg:"^(#*角色3|#*角色卡片|角色)$",fnc:"roleCard"},{reg:"^#[上期|往期|本期]*(深渊|深境|深境螺旋)[上期|往期|本期]*[ |0-9]*$",fnc:"abyss"},{reg:"^#*[上期|往期|本期]*(深渊|深境|深境螺旋)[上期|往期|本期]*[第]*(9|10|11|12|九|十|十一|十二)层[ |0-9]*$",fnc:"abyssFloor"},{reg:"^#[五星|四星|5星|4星]*武器[ |0-9]*$",fnc:"weapon"},{reg:"^#(宝箱|成就|尘歌壶|家园|探索|探险|声望|探险度|探索度)[ |0-9]*$",fnc:"roleExplore"}]}),Object.defineProperty(this,"button",{get(){return this.prefix=this.e?.isSr?"*":"#",segment.button([{text:"角色",callback:`${this.prefix}角色`},{text:"探索",callback:`${this.prefix}探索`},{text:"武器",callback:`${this.prefix}武器`},{text:"深渊",callback:`${this.prefix}深渊`}])}})}async init(){let e="./plugins/genshin/config/mys.pubCk.yaml";t.existsSync(e)||t.copyFileSync("./plugins/genshin/defSet/mys/pubCk.yaml",e);let s="./plugins/genshin/config/mys.set.yaml";t.existsSync(s)||t.copyFileSync("./plugins/genshin/defSet/mys/set.yaml",s)}accept(){if(!this.e.msg)return;if(!/^#(.*)$/.test(this.e.msg))return;let e=s.getRole(this.e.msg);return e?(this.e.msg="#角色详情",e.uid&&(this.e.msg+=e.uid),this.e.roleId=e.roleId,this.e.roleName=e.alias,!0):void 0}async abyss(){let e=await new r(this.e).getAbyss();e&&this.reply([await this.renderImg("genshin","html/abyss/abyss",e,{retType:"base64"}),this.button])}async abyssFloor(){let e=await new r(this.e).getAbyssFloor();e&&this.reply([await this.renderImg("genshin","html/abyss/abyss-floor",e,{retType:"base64"}),this.button])}async weapon(){let e=await a.get(this.e);e&&this.reply([await this.renderImg("genshin","html/avatar/weapon",e,{retType:"base64"}),this.button])}async roleCard(){let e=await new i(this.e).roleCard();e&&this.reply([await this.renderImg("genshin","html/player/role-card",e,{retType:"base64"}),this.button])}async roleExplore(){let e=await new i(this.e).roleExplore();e&&this.reply([await this.renderImg("genshin","html/player/role-explore",e,{retType:"base64"}),this.button])}}export{n as role};
