import{plugin as i}from"yunzai";import{gsCfg as e}from"yunzai-mys";import s from"../model/user.js";class t extends i{User=null;constructor(i){super({priority:300,rule:[{reg:"^#?(体力|[Cc](oo)?[Kk](ie)?)帮助",fnc:"ckHelp"},{reg:"^#[Cc](oo)?[Kk](ie)?代码$",fnc:"ckCode"},{reg:/^#绑定c(oo)?k(ie)?$/i,fnc:"bingCk"},{reg:"(.*)_MHYUUID(.*)",event:"message.private",fnc:"noLogin"},{reg:/^#?(原神|星铁)?我的c(oo)?k(ie)?$/i,event:"message",fnc:"myCk"},{reg:/^#?(原神|星铁)?删除c(oo)?k(ie)?$/i,fnc:"delCk"},{reg:/^#?(原神|星铁)?(删除|解绑)uid(\s|\+)*([0-9]{1,2})?$/i,fnc:"delUid"},{reg:/^#(原神|星铁)?绑定(uid)?(\s|\+)*([1-9]|18)[0-9]{8}$/i,fnc:"bingUid"},{reg:/^#(原神|星铁)?(我的)?(uid)[0-9]{0,2}$/i,fnc:"showUid"},{reg:/^#\\s*(检查|我的)*c(oo)?k(ie)?(状态)*$/i,fnc:"checkCkStatus"},{reg:"^#(接受)?绑定(主|子)?(用户|账户|账号)(\\[[a-zA-Z0-9_\\-:\\]+\\]){0,2}$",fnc:"bindNoteUser"},{reg:"^#(删除绑定|取消绑定|解除绑定|解绑|删除|取消)(主|子)(用户|账户|账号)$",fnc:"bindNoteUser"}]}),this.User=new s(i)}async init(){await this.loadOldData()}accept(){if(this.e.msg)return/(ltoken|ltoken_v2)/.test(this.e.msg)&&/(ltuid|login_uid|ltmid_v2)/.test(this.e.msg)?this.e.isGroup?(this.reply("请私聊发送Cookie",!1,{at:!0}),!0):(this.e.ck=this.e.msg,this.e.msg="#绑定Cookie",!0):/^#?(原神)?绑定uid$/i.test(this.e.msg)?(this.setContext("saveUid"),this.reply("请发送绑定的原神uid",!1,{at:!0}),!0):/^#?星铁绑定uid$/i.test(this.e.msg)?(this.setContext("saveSrUid"),this.reply("请发送绑定的星铁uid",!1,{at:!0}),!0):void 0}saveUid(){if(!this.e.msg)return;this.e.msg.match(/([1-9]|18)[0-9]{8}/g)?(this.e.msg="#绑定"+this.e.msg,this.bingUid(),this.finish("saveUid")):this.reply("原神UID输入错误",!1,{at:!0})}saveSrUid(){if(!this.e.msg)return;this.e.msg.match(/([1-9]|18)[0-9]{8}/g)?(this.e.msg="#星铁绑定"+this.e.msg,this.e.isSr=!0,this.e.game="sr",this.bingUid(),this.finish("saveSrUid")):this.reply("星铁UID输入错误",!1,{at:!0})}async noLogin(){this.reply("绑定Cookie失败\n请先【登录米游社】或【登录通行证】再获取Cookie")}async ckCode(){await this.reply("javascript:(()=>{prompt('',document.cookie)})();")}async ckHelp(){let i=e.getConfig("mys","set");await this.reply(`Cookie绑定配置教程：${i.cookieDoc}\n获取Cookie后【私聊发送】进行绑定`)}async bingCk(){let i=e.getConfig("mys","set");this.e.ck?await this.User.bing():await this.reply(`请【私聊】发送米游社Cookie，获取教程：\n${i.cookieDoc}`)}async delCk(){let i=await this.User.delCk();await this.reply(i)}async bingUid(){await this.User.bingUid()}async showUid(){let i=this.e.msg.match(/[0-9]{1,2}/g);i&&i[0]?await this.User.toggleUid(i[0]):await this.User.showUid()}async delUid(){let i=this.e.msg.match(/[0-9]{1,2}$/g);if(!i)return this.e.reply("删除uid请带上序号\n例如：#删除uid1\n发送【#uid】可查看绑定的uid以及对应的序号"),!0;let e=i&&i[0],s=this.e;e&&await this.User.delUid(e,s)}async myCk(){this.e.isGroup?await this.reply("请私聊查看"):await this.User.myCk()}async loadOldData(){await this.User.loadOldDataV2(),await this.User.loadOldDataV3(),await this.User.loadOldUid()}async checkCkStatus(){await this.User.checkCkStatus()}async bindNoteUser(){await this.User.bindNoteUser()}}export{t as user};
