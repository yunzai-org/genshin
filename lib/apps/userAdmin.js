import{plugin as e}from"yunzai";import t from"../model/user.js";import{MysInfo as s}from"yunzai-mys";class i extends e{User=null;button=null;constructor(e){super({event:"message",priority:300,rule:[{reg:"^#用户统计$",fnc:"userAdmin",permission:"master"},{reg:"^#(刷新|重置)用户(缓存|统计|ck|Ck|CK)$",fnc:"resetCache",permission:"master"},{reg:"^#删除(无效|失效)(用户|ck|Ck|CK)$",fnc:"delDisable",permission:"master"}]}),this.User=new t(e),this.button=segment.button([{text:"用户统计",callback:"#用户统计"},{text:"删除无效",callback:"#删除无效用户"}],[{text:"刷新统计",callback:"#刷新用户统计"},{text:"重置统计",callback:"#重置用户统计"}])}async userAdmin(){let e=await new t(this.e).userAdmin();if(!e)return!0;this.reply([await this.renderImg("genshin","html/admin/userAdmin",e,{retType:"base64"}),this.button])}async resetCache(){const e=/重置/.test(this.e.msg);await s.initCache(!0,e),this.reply([`用户缓存已${e?"重置":"刷新"}...\n通过【#用户统计】命令可查看详情`,this.button])}async delDisable(){let e=await s.delDisable();this.reply([e>0?`已删除${e}个无效用户`:"暂无无效用户...",this.button])}}export{i as userAdmin};
