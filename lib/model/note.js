import e from"moment";import t from"lodash";import r from"./base.js";import{MysInfo as a}from"yunzai-mys";import{Character as i}from"../miao.js";class o extends r{constructor(e){super(e),this.model="dailyNote"}static async get(e){let t=new o(e);return await t.getData()}async getData(){let e,t=await a.get(this.e,"getFp"),r={"x-rpc-device_fp":t?.data?.device_fp},i=await a.get(this.e,"dailyNote",{headers:r});if(!i||0!==i.retcode)return!1;let o=this.e.isSr?this.noteSr(i):this.noteData(i),m=this.screenData;return!(this.e.isSr&&(e=await a.get(this.e,"UserGame",{headers:r}),e.data?.list?.forEach((e=>this.e.uid.includes(e.game_biz))),!e||0!==e.retcode))&&{name:this.e.sender.card,quality:80,...m,...o,...e?.data?.list[0]}}noteSr(r){let a,{data:o}=r;if(e().date(),Number(e().format("X")),o.stamina_recover_time>0){let t=e.duration(o.stamina_recover_time,"seconds"),r=Math.floor(t.asDays()),i=t.hours(),m=t.minutes(),s=t.seconds();if(a=i+"小时"+m+"分钟"+s+"秒",r>0?a=r+"天"+i+"小时"+m+"分钟"+s+"秒":i>0?a=i+"小时"+m+"分钟"+s+"秒":m>0?a=m+"分钟"+s+"秒":s>0&&(a=s+"秒"),r>0||i>0||s>0){let e=3600*i+60*m+s;const t=new Date,r=t.getTime()+1e3*e,o=new Date(r);a+=` | [${0===o.getDate()-t.getDate()?"今日":"明日"}]${`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`}`}}o.bfStamina=o.current_stamina/o.max_stamina*100+"%";for(let t of o.expeditions){let r=e.duration(t.remaining_time,"seconds"),a=Math.floor(r.asDays()),i=r.hours(),o=r.minutes();t.dateTime=[a+"天",i+"时",o+"分"].filter((e=>!["0天","0时","0分"].includes(e))).join(""),t.bfTime=(72e3-t.remaining_time)/72e3*100+"%",1==t.avatars.length&&t.avatars.push("派遣头像")}let m=t.sample(["希儿","白露","艾丝妲","布洛妮娅","姬子","卡芙卡","克拉拉","停云","佩拉","黑塔","希露瓦","银狼"]),s=i.get(m,"gs"),n=`${["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][e().day()]}`;return{uid:this.e.uid,saveId:this.e.uid,icon:s.imgs?.face,day:n,resinMaxTime:a,nowDay:e(new Date).format("YYYY年MM月DD日"),...o}}noteData(r){let a,{data:i}=r,o=e().date(),m=Number(e().format("X"));if(i.resin_recovery_time>0){a=m+Number(i.resin_recovery_time);let t=e.unix(a);a=t.format("HH:mm"),a=t.date()!=o?`明天 ${a}`:` ${a}`}let s="";if(i.expeditions&&i.expeditions.length>=1&&(s=t.map(i.expeditions,"remained_time"),s=t.min(s),s>0)){s=m+Number(s);let t=e.unix(s);s=t.format("HH:mm"),s=t.date()!=o?`明天 ${s}`:` ${s}`}let n="";if(i.home_coin_recovery_time>0){let t=Math.floor(i.home_coin_recovery_time/3600/24),r=Math.floor(i.home_coin_recovery_time/3600%24),a=Math.floor(i.home_coin_recovery_time/60%60);if(t>0)n=`${t}天${r}小时${a}分钟`;else{let t=e.unix(m+Number(i.home_coin_recovery_time));n=t.date()!=o?`明天 ${t.format("HH:mm")}`:t.format("HH:mm")}}let d=`${e().format("MM-DD HH:mm")} ${["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][e().day()]}`;if(i?.transformer?.obtained){i.transformer.reached=i.transformer.recovery_time.reached;let e="";i.transformer.recovery_time.Day>0&&(e+=`${i.transformer.recovery_time.Day}天`),i.transformer.recovery_time.Hour>0&&(e+=`${i.transformer.recovery_time.Hour}小时`),i.transformer.recovery_time.Minute>0&&(e+=`${i.transformer.recovery_time.Minute}分钟`),i.transformer.recovery_time=e}return{uid:this.e.uid,saveId:this.e.uid,resinMaxTime:a,remainedTime:s,coinTime:n,day:d,...i}}}export{o as default};
