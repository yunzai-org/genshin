import e from"./base.js";import{MysInfo as a,gsCfg as t}from"yunzai-mys";import{chain as r}from"lodash-es";import{Character as o,Weapon as l}from"../miao.js";class n extends e{constructor(e){super(e)}e;model="weapon";static async get(e){let a=new n(e);return await a.getData(e)}async getData(e){let t=await a.get(this.e,"character");if(!t||0!==t.retcode)return!1;let r=t.data.avatars;return r.length<=0||{...this.screenData,saveId:this.e.uid,uid:this.e.uid,...this.dealData(r)}}dealData(e){let a=t.getdefSet("weapon","other").actWeapon;t.getdefSet("weapon","other").sortName;let n=[],i={five:0,four:0,three:0,"单手剑":0,"双手剑":0,"长柄武器":0,"弓":0,"法器":0};for(let r of e){if(r.weapon.rarity<=1)continue;r.name=t.roleIdToName(r.id),r.rarity>5&&(r.rarity=5),5==r.weapon.rarity&&i.five++,4==r.weapon.rarity&&i.four++,3==r.weapon.rarity&&i.three++,i[r.weapon.type_name]++;let e=0;e+=r.weapon.level,e+=20*(r.weapon.rarity-4),r.weapon.level>=20&&(e+=r.level),a.includes(r.weapon.name)||(e+=5*r.weapon.affix_level);let s=0;s+=1e6*r.weapon.rarity,s+=1e5*r.weapon.affix_level,s+=1e3*r.weapon.level,s+=100*r.rarity,s+=r.level;let p=o.get(r.name),f=l.get(r.weapon.name);p&&f&&n.push({role_name:p.abbr,role_icon:p.side,role_level:r.level,role_rarity:r.rarity,name:r.weapon.name,icon:f.icon,showName:f.abbr,rarity:r.weapon.rarity,level:r.weapon.level,affix_level:r.weapon.affix_level,firstSort:e,sort:s})}return n=r(n).orderBy(["firstSort"],["desc"]).orderBy(["sort"],["desc"]).value(),{list:n,count:i}}}export{n as default};
